<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:300&display=swap" rel="stylesheet">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <script>
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.write('<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css">');
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.write('<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github-gist.min.css">');
      }
    </script>
    <script type="module" src="/assets/components/dist/mi-components/mi-components.esm.js"></script>
    <script nomodule src="/assets/components/dist/mi-components/mi-components.js"></script>
    <title>Get Directions and Show Wayfinding Instructions - MapsIndoors Documentation</title>
  </head>


<body>
  <header>
  <div class="wrap">
    <section class="flex">
      <div class="left">
        <a href="/">
          <svg width="200" height="39" viewBox="0 0 200 39" fill="none" xmlns="http://www.w3.org/2000/svg" class="mapspeople-logo">
            <g clip-path="url(#clip0)">
              <path d="M13.2756 10.5368C14.766 9.49696 16.8804 8.87305 18.4402 8.87305C23.3622 8.87305 25.4073 11.438 25.4073 15.5282V28.6304H20.5199V15.7361C20.5199 14.315 19.7227 13.6564 18.4402 13.6564C16.7764 13.6564 15.7712 14.1417 15.1473 14.419V28.6304H10.26V15.7361C10.26 14.315 9.46274 13.6564 8.18024 13.6564C6.72444 13.6564 5.68457 14.0724 4.88735 14.419V28.6304H0V9.49696H3.43154L3.70884 10.1555C5.06066 9.39298 6.82842 8.90771 8.14558 8.90771C10.8492 8.87305 12.2704 9.56629 13.2756 10.5368Z" fill="#006440"></path>
              <path d="M40.6926 15.6321C40.6926 14.2803 39.9994 13.6564 38.2316 13.6564C36.3598 13.6564 33.7948 14.1417 31.7844 14.8696V10.0169C33.8988 9.04636 36.5331 8.87305 38.2316 8.87305C44.0202 8.87305 45.5106 11.6807 45.5106 15.8748V28.6304H42.1137L41.8364 28.0412C40.5193 28.7344 38.7515 29.2197 37.4344 29.2197C32.2004 29.2197 30.502 25.9268 30.502 22.3566C30.502 19.029 32.3044 16.1867 37.4344 15.8401L40.6926 15.6321ZM37.5383 20.3115C35.8399 20.4502 35.3893 21.4207 35.3893 22.3912C35.3893 23.2578 35.6319 24.471 37.5037 24.471C38.5435 24.471 39.9647 23.951 40.6926 23.5698V20.1036L37.5383 20.3115Z" fill="#006440"></path>
              <path d="M51.1616 9.49696H54.5585L54.8011 10.1902C56.1183 9.39298 57.99 8.87305 59.4112 8.87305C65.893 8.87305 67.7301 12.5126 67.7301 19.0637C67.7301 25.6495 65.893 29.2543 59.4112 29.2543C58.3713 29.2543 56.8809 28.9424 55.945 28.5264V38.1971H51.127V9.49696H51.1616ZM55.945 23.7084C56.7422 24.055 58.0247 24.4363 59.3419 24.4363C62.2535 24.4363 62.8081 22.1486 62.8081 19.029C62.8081 15.9094 62.2188 13.6217 59.3419 13.6217C58.0247 13.6217 56.7422 14.003 55.945 14.3497V23.7084Z" fill="#006440"></path>
              <path d="M79.8957 16.4645C85.3723 16.9844 86.6202 19.0295 86.6202 22.5997C86.6202 25.8233 84.7484 29.2548 78.9252 29.2548C77.1921 29.2548 74.4191 28.6656 72.894 28.0763V23.0503C74.6271 23.7089 76.9495 24.4368 78.9945 24.4368C81.2476 24.4368 81.9061 23.4662 81.9061 22.6344C81.9061 21.8718 81.4555 21.2825 79.4451 21.1092C74.0725 20.5893 72.7207 18.3016 72.7207 15.3207C72.7207 12.3397 74.5231 8.83887 79.9304 8.83887C81.6288 8.83887 83.6739 9.11616 85.823 10.0867V14.9047C83.7779 14.1768 81.8715 13.5876 79.9304 13.5876C77.8853 13.5876 77.4347 14.3501 77.4347 15.2167C77.4001 15.8753 77.816 16.2565 79.8957 16.4645Z" fill="#006440"></path>
              <path d="M93.3797 27.2097V38.1629H92.2012V9.53206H92.7211L93.2757 11.0225C94.9741 9.91334 97.8511 9.35875 100.069 9.35875C106.517 9.35875 108.111 13.5875 108.111 19.0988C108.111 24.6101 106.517 28.8388 100.069 28.8388C97.8858 28.8042 95.1128 28.2842 93.3797 27.2097ZM93.3797 11.9931V26.1698C95.1128 27.2444 97.3312 27.7643 100.069 27.7643C105.858 27.7643 106.898 23.3622 106.898 19.0641C106.898 14.766 105.858 10.364 100.069 10.364C97.3658 10.364 95.1474 10.9185 93.3797 11.9931ZM127.834 26.8284V27.8683C126.309 28.4575 123.744 28.8388 121.664 28.8388C115.217 28.8388 113.622 24.7834 113.622 19.0988C113.622 13.4142 115.217 9.35875 121.664 9.35875C128.111 9.35875 128.804 13.4835 128.804 19.0988V19.6187H114.801C114.87 23.9168 116.083 27.799 121.629 27.799C124.541 27.7643 126.413 27.279 127.834 26.8284ZM127.66 18.5442C127.66 14.3847 127.244 10.364 121.664 10.364C116.118 10.364 114.905 14.2114 114.835 18.5442H127.66ZM141.976 9.35875C148.77 9.35875 149.983 13.4835 149.983 19.0988C149.983 24.714 148.77 28.8388 141.976 28.8388C135.182 28.8388 133.969 24.714 133.969 19.0988C133.934 13.4835 135.147 9.35875 141.976 9.35875ZM141.976 27.7643C148.076 27.7643 148.77 23.8821 148.77 19.0641C148.77 14.2461 148.076 10.364 141.976 10.364C135.875 10.364 135.147 14.2808 135.147 19.0641C135.147 23.8821 135.841 27.7643 141.976 27.7643ZM156.673 27.2097V38.1629H155.494V9.53206H156.014L156.569 11.0225C158.267 9.91334 161.144 9.35875 163.362 9.35875C169.809 9.35875 171.404 13.5875 171.404 19.0988C171.404 24.6101 169.809 28.8388 163.362 28.8388C161.179 28.8042 158.371 28.2842 156.673 27.2097ZM156.673 11.9931V26.1698C158.406 27.2444 160.624 27.7643 163.362 27.7643C169.151 27.7643 170.191 23.3969 170.191 19.0641C170.191 14.766 169.151 10.364 163.362 10.364C160.624 10.364 158.406 10.9185 156.673 11.9931ZM180.173 28.8042C178.128 28.8042 177.227 27.9029 177.227 26.0312V0H178.406V25.9619C178.406 27.4177 178.787 27.9029 180.208 27.9029V28.8042H180.173ZM198.891 26.8284V27.8683C197.366 28.4575 194.801 28.8388 192.721 28.8388C186.274 28.8388 184.68 24.7834 184.68 19.0988C184.68 13.4142 186.239 9.35875 192.721 9.35875C199.168 9.35875 199.861 13.4835 199.861 19.0988V19.6187H185.858C185.927 23.9168 187.141 27.799 192.686 27.799C195.598 27.7643 197.435 27.279 198.891 26.8284ZM198.683 18.5442C198.683 14.3847 198.267 10.364 192.686 10.364C187.106 10.364 185.927 14.2114 185.858 18.5442H198.683Z" fill="#006440"></path>
            </g>
            <defs>
              <clipPath id="clip0">
                <rect width="200" height="38.4749" fill="white"></rect>
              </clipPath>
            </defs>
          </svg>
        </a>
      </div>
      <div class="right">
        <a href="https://mapspeople.com/support">Support</a>
        <a href="https://github.com/mapsindoors">GitHub</a>
        <a href="https://blog.mapspeople.com/tag/product">Product Blog</a>
        <a href="https://cms.mapsindoors.com/">CMS</a>
      </div>
    </section>
  </div>
</header>

  <div class="content">
    <div class="wrap">
      <section class="container">
        
         <nav class="sidebar">
  
  
  
  
   <p class="nav__header"><a href="/ios/v3/">iOS v3</p>
    <a href="https://app.mapsindoors.com/mapsindoors/reference/ios/v3/index.html">Reference Docs
      &UpperRightArrow;</a>
    <hr />
    
  
  
  
  
  <ul class="sidebar-nav"><li><a href="/ios/v3/getting-started/">Getting Started</a></li>
<li><a href="/ios/v3/directions/">Directions</a><ul><li class="active"><a href="/ios/v3/directions/directions-wayfinding-instructions/">Get Directions and Show Wayfinding Instructions</a></li>
<li><a href="/ios/v3/directions/display-route-on-map/">Display Route on map</a></li>
<li><a href="/ios/v3/directions/directions-result-map/">Get Directions and Show the Result on a Map</a></li>
<li><a href="/ios/v3/directions/working-with-directions-settings/">Working with Directions Settings</a></li>
<li><a href="/ios/v3/directions/working-with-events/">Working with Events</a></li>
<li><a href="/ios/v3/directions/subscribe-to-floor-changes/">Subscribe to floor changes in the rendering</a></li></ul></li>
<li><a href="/ios/v3/locations/">Locations</a><ul><li><a href="/ios/v3/locations/working-grouping/">Working with Location Grouping (Clustering)</a></li>
<li><a href="/ios/v3/locations/creating-own-location-sources/">Creating your own Location Sources</a></li>
<li><a href="/ios/v3/locations/get-details-for-selected-location/">Show details for selected Location</a></li></ul></li>
<li><a href="/ios/v3/live-data/">Live Data</a><ul><li><a href="/ios/v3/live-data/live-data-tutorial/">Working with Live Updates / Real Time Data in MapsIndoors for iOS</a></li></ul></li>
<li><a href="/ios/v3/map-styling/">Map Styling</a><ul><li><a href="/ios/v3/map-styling/change-display-setting/">Working with Display Settings</a></li></ul></li>
<li><a href="/ios/v3/mapsindoors/">MapsIndoors</a><ul><li><a href="/ios/v3/mapsindoors/handling-marker-selections/">Handling marker selections and other user events</a></li>
<li><a href="/ios/v3/mapsindoors/getting-marker-from-location/">Getting a marker from a location and vice versa</a></li>
<li><a href="/ios/v3/mapsindoors/getting-polygon-from-location/">Getting a polygon from a location</a></li>
<li><a href="/ios/v3/mapsindoors/blue-dot/">Show the user's location aka. Blue Dot</a></li>
<li><a href="/ios/v3/mapsindoors/create-custom-ui/">Create custom UI</a></li></ul></li>
<li><a href="/ios/v3/search/">Create a search experience with MapsIndoors</a><ul><li><a href="/ios/v3/search/filter-locations-on-map-by-search-query/">Filter Locations on map by search query</a></li></ul></li>
<li><a href="/ios/v3/offline/">Caching and offline content</a></li></ul>
</nav>

        
        <main>
          <nav aria-label="Breadcrumb">
            <ol class="breadcrumb"><span class="item"><a href="/">Home</a></span>
<span class="item"><a href="/ios/v3/">iOS v3</a></span>
<span class="item"><a href="/ios/v3/directions/">Directions</a></span></ol>
          </nav>
          <h1>
            <a href="/ios/v3/directions/directions-wayfinding-instructions/">Get Directions and Show Wayfinding Instructions</a>
          </h1>
          
            <p class="time">Last updated: <time>11/27/2020</time>
            </p>
          
          <p>In this tutorial we will show how to work with the route model returned from a directions service call. We will also show how you can utilize interaction between the route rendering on the map and textual instructions showed in another view.</p>
<p>We will start by creating our implementation of a custom <code>UICollectionViewCell</code> that will hold the instructions for a single segment of a route.</p>
<p>In the route model there are some text properties that we will interpret as enum values, so start out by creating enums <code>RouteContext</code> describing whether we are outside or inside and <code>WayType</code> describing what kind of facility we are walking/travelling through.</p>
<pre><code class="language-swift">enum RouteContext : String
{
    case insideBuilding = &quot;InsideBuilding&quot;
    case outsideOnVenue = &quot;OutsideOnVenue&quot;
}

enum WayType : String
{
    case stairs = &quot;steps&quot;
    case elevator = &quot;elevator&quot;
    case travellator = &quot;travellator&quot;
    case escalator = &quot;escalator&quot;
    case footway = &quot;footway&quot;
    case residential = &quot;residential&quot;
}

</code></pre>
<p>Create a subclass of <code>UICollectionViewCell</code> called <code>RouteSegmentView</code></p>
<pre><code class="language-swift">class RouteSegmentView : UITableViewCell {
</code></pre>
<p>Add a property called <code>route</code> that holds entire route model.</p>
<pre><code class="language-swift">private var route:MPRoute = MPRoute()
</code></pre>
<p>Add a property called <code>segment</code> that holds the actual segment of <code>route</code> that this view is going to reflect.</p>
<pre><code class="language-swift">private var segment:MPRouteSegmentPath = MPRouteSegmentPath()
</code></pre>
<p>Add a method called <code>renderRouteInstructions</code> that updates <code>segment</code> and <code>route</code>. Call the method <code>updateViews</code> when set.</p>
<pre><code class="language-swift">func renderRouteInstructions(_ route:MPRoute, for segment:MPRouteSegmentPath) {
    self.route = route
    self.segment = segment
    updateViews()
}
</code></pre>
<h2>Helper methods</h2>
<p>We will need some helper methods. First create a method that can get us the previous step for later comparison.</p>
<pre><code class="language-swift">fileprivate func getPreviousStep(_ stepIndex: Int, _ legIndex: Int, _ route: MPRoute) -&gt; MPRouteStep? {

    var previousStep: MPRouteStep?
    if stepIndex-1 &lt; 0 {
        if segment.legIndex-1 &gt;= 0 {
            let previousLeg = route.legs?[segment.legIndex-1] as? MPRouteLeg
            previousStep = previousLeg?.steps?.lastObject as? MPRouteStep
        }
    } else if let leg = route.legs?[segment.legIndex] as? MPRouteLeg {
        previousStep = leg.steps?[stepIndex-1] as? MPRouteStep
    }
    return previousStep
}
</code></pre>
<p>Create a method <code>getOutsideInsideInstructions</code> that can get us instructions for walking inside or out of a building. This is determined by the <code>routeContext</code> property of an <code>MPRouteStep</code></p>
<pre><code class="language-swift">fileprivate func getOutsideInsideInstructions(_ previousStep: MPRouteStep, _ currentStep: MPRouteStep) -&gt; String? {
    var instructions:String?
    if let previousContext = previousStep.routeContext {
        if previousContext != currentStep.routeContext {

            let ctx = RouteContext.init(rawValue: currentStep.routeContext ?? &quot;&quot;)

            if ctx == .insideBuilding {
                instructions = &quot;Walk inside&quot;
            } else if ctx == .outsideOnVenue {
                instructions = &quot;Walk outside&quot;
            }

        }
    }
    return instructions
}
</code></pre>
<p>Create a method <code>getElevationInstructions</code> that can get us instructions for taking the stairs or elevator to another floor. This is determined by the <code>highway</code> and <code>end_location.zLevel</code> properties of a <code>MPRouteStep</code>.</p>
<pre><code class="language-swift">fileprivate func getElevationInstructions(_ currentStep: MPRouteStep) -&gt; String? {
    var instructions:String?
    if currentStep.start_location?.zLevel?.intValue != currentStep.end_location?.zLevel?.intValue {

        let floor = currentStep.end_location?.floor_name ?? &quot;&quot;
        let wayType = WayType.init(rawValue: currentStep.highway ?? &quot;&quot;) ?? .footway

        switch (wayType) {
            case .elevator, .escalator, .stairs, .travellator:
                instructions = &quot;Take the \(wayType.rawValue) to floor \(floor)&quot;
            default:
                instructions = &quot;Go to level \(floor)&quot;
        }
    }
    return instructions
}
</code></pre>
<p>Create a method <code>getDefaultInstructions</code> that can get us information about the default instructions in a route step. In some cases they are html formatted, so we need to pass it through an interpreter.</p>
<pre><code class="language-swift">fileprivate func getDefaultInstructions(_ currentStep: MPRouteStep) -&gt; String? {
    if let html = currentStep.html_instructions {
        return String(htmlEncodedString: html)
    }
    return nil
}
</code></pre>
<p>Create a method <code>getDistanceInstructions</code> that can get us information about the travelling distance. This is determined by the <code>duration</code> property of a <code>MPRouteLeg</code>. The distance is returned in meters so if you require imperial units, make a conversion.</p>
<pre><code class="language-swift">fileprivate func getDistanceInstructions(_ distance:NSNumber?) -&gt; String {
    let feet = Int((distance?.doubleValue ?? 0) * 3.28)
    return &quot;Continue for \(feet) feet&quot;
}
</code></pre>
<h2>Suggested logic for generating meaningful instructions</h2>
<p>Obviously it is up to your application to present some instructions to the end user, but here a suggestion. Add a method called <code>updateViews</code> that will fire whenever our models change.</p>
<pre><code class="language-swift">func updateViews() {
</code></pre>
<p>Initialise an array of textual instructions and check for existence of a current leg.</p>
<pre><code class="language-swift">if route.legs?.count ?? 0 &gt; 0 {
    var instructions = [String]()
    if let currentLeg = route.legs?[segment.legIndex] as? MPRouteLeg {
</code></pre>
<p>Add instructions for inside/outside as well as elevation instruction if applicable.</p>
<pre><code class="language-swift">if segment.stepIndex &gt;= 0, let currentStep = currentLeg.steps?[segment.stepIndex] as? MPRouteStep {
    if let previousStep = getPreviousStep(segment.stepIndex, segment.legIndex, route) {
        if let outsideInsideInstructions = getOutsideInsideInstructions(previousStep, currentStep) {
            instructions.append(outsideInsideInstructions)
        }
    }
    if let elevationInstructions = getElevationInstructions(currentStep) {
        instructions.append(elevationInstructions)
    }
    if let defaultInstructions = getDefaultInstructions(currentStep) {
        instructions.append(defaultInstructions)
    }
    instructions.append(getDistanceInstructions(currentStep.distance))
}
</code></pre>
<p>We need a method to parse html because the directions instructions from Google contains html.</p>
<pre><code class="language-swift">extension String {

    init?(htmlEncodedString: String) {

        guard let data = htmlEncodedString.data(using: .utf8) else {
            return nil
        }

        let options: [NSAttributedString.DocumentReadingOptionKey: Any] = [
            NSAttributedString.DocumentReadingOptionKey.documentType: NSAttributedString.DocumentType.html,
            NSAttributedString.DocumentReadingOptionKey.characterEncoding: String.Encoding.utf8.rawValue
        ]

        guard let attributedString = try? NSAttributedString(data: data, options: options, documentAttributes: nil) else {
            return nil
        }

        self.init(attributedString.string)
    }

}
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Advanced%20Directions/RouteSegmentView.swift">See the sample in RouteSegmentView.swift</a></p>
<h2>Create the controller that displays generated textual instructions segment by segment</h2>
<p>We use a collection view to do this but you can of course use whatever view that fits your use case best.</p>
<p>First we will define a protocol called <code>RouteSegmentsControllerDelegate</code> that will be used to handle the selection of each represented route segment. The method <code>didSelectRouteSegment</code> will be delegating the handling of route segment selections.</p>
<pre><code class="language-swift">protocol RouteSegmentsControllerDelegate {
    func didSelectRouteSegment(segment:MPRouteSegmentPath)
}
</code></pre>
<h2>The Route Segments Controller</h2>
<p>Create a controller class called <code>RouteSegmentsController</code> that inherits from <code>UIViewController</code>.</p>
<pre><code class="language-swift">class RouteSegmentsController : UIViewController {
</code></pre>
<p>Add some properties to the controller</p>
<ul>
<li><code>startingScrollingOffset</code> We will do a side-ways scroll in the collection, so we will add a private point property to keep track of that</li>
<li><code>tableView</code> the actual table view property.</li>
<li><code>delegate</code> the delegate property.</li>
</ul>
<pre><code class="language-swift">private var startingScrollingOffset = CGPoint.zero
private var tableView:UITableView!
var delegate:RouteSegmentsControllerDelegate?
</code></pre>
<p>Add a <code>route</code> property to the class</p>
<pre><code class="language-swift">var route:MPRoute = MPRoute() {
    didSet {
        self.tableView.reloadData()
    }
}
</code></pre>
<p>Add a <code>currentSegment</code> property to the class</p>
<pre><code class="language-swift">var currentSegment:MPRouteSegmentPath = MPRouteSegmentPath() {
    didSet {
        if oldValue.legIndex != currentSegment.legIndex {
            self.tableView.reloadData()
        }
    }
}
</code></pre>
<p>Implement <code>viewDidLoad</code> method, creating the horizontal collection view and assigning delegates to the collection view. Make sure that you register your own custom <code>RouteSegmentView</code> here.</p>
<pre><code class="language-swift">override func viewDidLoad() {
    self.tableView = UITableView.init(frame: view.frame)
</code></pre>
<p>Create a method 'updateRouteSegmentSelection' that notifies the delegate</p>
<pre><code class="language-swift">func updateRouteSegmentSelection(segment: MPRouteSegmentPath) {
    delegate?.didSelectRouteSegment(segment: segment)
    currentSegment = segment
}
</code></pre>
<h2>The Route Segments Controller Data Source</h2>
<p>Create an extension of <code>RouteSegmentsController</code> that implements <code>UICollectionViewDataSource</code> protocol.</p>
<pre><code class="language-swift">extension RouteSegmentsController : UITableViewDataSource {
</code></pre>
<p>In the <code>collectionView numberOfItemsInSection</code> method, let the item count reflect the number of legs in the current route.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {
    let leg = route.legs?[section] as? MPRouteLeg
    return leg?.steps?.count ?? 0
}
</code></pre>
<p>In the <code>collectionView cellForItemAt indexPath</code> method, create a segment based on the index paths row (leg) index. Dequeue a cell view and update the <code>route</code> and <code>segment</code> properties accordingly.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
    let segment = MPRouteSegmentPath(legIndex: indexPath.section, stepIndex: indexPath.row)
    let tvCell:RouteSegmentView = tableView.dequeueReusableCell(withIdentifier: &quot;TVC&quot;, for: indexPath) as! RouteSegmentView
    tvCell.renderRouteInstructions(route, for: segment)
    return tvCell
}
</code></pre>
<p>In the <code>titleForHeaderInSection</code> method, return the number of legs in the current route.</p>
<pre><code class="language-swift">func numberOfSections(in tableView: UITableView) -&gt; Int {
    return route.legs?.count ?? 0
}
</code></pre>
<p>Implement the <code>heightForRowAtIndexPath</code> method.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat {
    return 80
}
</code></pre>
<p>Optionally implement the <code>titleForHeaderInSection</code> method.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -&gt; String? {
    if let leg = route.legs?[section] as? MPRouteLeg {
        let meters = leg.distance?.intValue ?? 0
        return &quot;\(meters) meters&quot;
    }
    return &quot;&quot;
}
</code></pre>
<h2>Table View Delegate</h2>
<p>Create an extension of <code>RouteSegmentsController</code> that implements <code>UITableViewDelegate</code> protocol. In method <code>didSelectRowAtIndexPath</code> update the current route segment.</p>
<pre><code class="language-swift">extension RouteSegmentsController : UITableViewDelegate {
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        updateRouteSegmentSelection(segment: MPRouteSegmentPath(legIndex: indexPath.section, stepIndex: indexPath.row))
    }
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Advanced%20Directions/RouteSegmentsController.swift">See the sample in RouteSegmentsController.swift</a></p>
<h2>Create a controller that renders a map and utilizes interaction between a route rendered on the map and the selected instructions</h2>
<p>Start by creating a controller class <code>AdvancedDirectionsController</code> that inherits from <code>UIViewController</code></p>
<pre><code class="language-swift">class AdvancedDirectionsController: UIViewController {
</code></pre>
<p>Setup map-related member variables for <code>AdvancedDirectionsController</code>:</p>
<ul>
<li>A Google Maps <code>map</code> property</li>
<li>A MapsIndoors <code>mapControl</code> property</li>
<li>A MapsIndoors <code>renderer</code> property</li>
<li>A <code>routeVC</code> property used as a child view controller to this VC</li>
</ul>
<pre><code class="language-swift">var map: GMSMapView! = nil
var mapControl: MPMapControl! = nil
var renderer: MPDirectionsRenderer! = nil
var stepWiseRenderer: MPDirectionsRenderer! = nil
</code></pre>
<p>Setup directions related member variables for <code>AdvancedDirectionsController</code>:</p>
<ul>
<li>A <code>routeVC</code> property used as a child view controller to this VC</li>
<li>A <code>heightConstraintForRouteView</code> property that can control the visibility of the route view</li>
<li>A <code>directionsVisible</code> bool that can control the visibility of the route view by affecting the height of the route view</li>
<li>A <code>searchButton</code> that will open a search controller to choose your destination</li>
</ul>
<pre><code class="language-swift">var routeVC: RouteSegmentsController! = nil
var heightConstraintForRouteView:NSLayoutConstraint! = nil
var directionsVisible:Bool! {
    didSet {
        heightConstraintForRouteView.constant = directionsVisible ? 240 : 0
        UIView.animate(withDuration: 0.3) {
            self.view.layoutIfNeeded()
        }
    }
}
var searchButton:UIButton! = nil
let directions = MPDirectionsService.init()
var destinationLocation:MPLocation? {
    didSet {
        updateDirections()
        searchButton.setTitle(destinationLocation?.name, for: .normal)
    }
}
var originLocation:MPLocation?
</code></pre>
<p>Create a <code>setupMap</code> method that sets up the Google map and MapsIndoors Map Control object.</p>
<pre><code class="language-swift">fileprivate func setupMap() {
    self.map = GMSMapView.init(frame: CGRect.zero)
    self.map.camera = .camera(withLatitude: 57.057964, longitude: 9.9504112, zoom: 20)
    self.mapControl = MPMapControl.init(map: self.map!)
    view.addSubview(self.map)
}
</code></pre>
<p>Create a <code>setupSearchButton</code> method that sets up a button that can trigger the destination location selection.</p>
<pre><code class="language-swift">fileprivate func setupSearchButton() {
    searchButton = UIButton.init()
    searchButton.setTitle(&quot;Search Destination&quot;, for: .normal)
    searchButton.addTarget(self, action: #selector(selectDestination), for: .touchUpInside)
    searchButton.backgroundColor = .blue
    view.addSubview(searchButton)
}
</code></pre>
<p>Create a <code>setupConstraints</code> method that sets up all the layout constraints. In your projects you might do all this in a storyboard.</p>
<pre><code class="language-swift">fileprivate func setupConstraints() {

    map.translatesAutoresizingMaskIntoConstraints = false
    map.widthAnchor.constraint(equalTo:view.widthAnchor).isActive = true
    map.topAnchor.constraint(equalTo:view.topAnchor).isActive = true

    searchButton.translatesAutoresizingMaskIntoConstraints = false
    searchButton.heightAnchor.constraint(equalToConstant: 68).isActive = true
    searchButton.widthAnchor.constraint(equalTo:view.widthAnchor).isActive = true
    searchButton.topAnchor.constraint(equalTo: map.bottomAnchor).isActive = true

    routeVC.view.translatesAutoresizingMaskIntoConstraints = false
    routeVC.view.widthAnchor.constraint(equalTo:view.widthAnchor).isActive = true
    routeVC.view.bottomAnchor.constraint(equalTo:view.bottomAnchor).isActive = true
    routeVC.view.topAnchor.constraint(equalTo:searchButton.bottomAnchor).isActive = true

    heightConstraintForRouteView = routeVC.view.heightAnchor.constraint(equalToConstant:0)
    heightConstraintForRouteView.isActive = true
}
</code></pre>
<p>Create a <code>setupRouteNav</code> method that instantiates <code>RouteSegmentsController</code> and adds it as a child view controller. Assign this controller as its delegate.</p>
<pre><code class="language-swift">fileprivate func setupRouteNav() {
    routeVC = RouteSegmentsController.init()
    self.addChildViewController(routeVC!)
    view.addSubview(routeVC.view)
    routeVC.didMove(toParentViewController: self)
    routeVC.delegate = self as RouteSegmentsControllerDelegate
}
</code></pre>
<p>Create a <code>selectDestination</code> method that instantiates and presents <code>MySearchController</code>. Assign this controller as its delegate.</p>
<pre><code class="language-swift">@objc fileprivate func selectDestination() {
    let searchController = MySearchController.init(near: nil)
    searchController.delegate = self
    self.present(searchController, animated: true, completion: nil)
}
</code></pre>
<p>Create a <code>setupRenderer</code> method that instantiates <code>MPDirectionsRenderer</code> and adds it as a child view controller. Assign this controller as its delegate.</p>
<pre><code class="language-swift">fileprivate func setupRenderer() {
    self.renderer = MPDirectionsRenderer.init()
    self.renderer.delegate = self as MPDirectionsRendererDelegate
    self.renderer.fitBounds = true
    self.renderer.solidColor = .clear
    self.renderer.map = self.map

    self.stepWiseRenderer = MPDirectionsRenderer.init()
    self.stepWiseRenderer.fitBounds = false
    self.stepWiseRenderer.map = self.map
    self.stepWiseRenderer.nextRouteLegButton?.isHidden = true
    self.stepWiseRenderer.previousRouteLegButton?.isHidden = true
}
</code></pre>
<p>Create a <code>setOriginLocation</code> method that mocks a origin location by searching for a random venue in MapsIndoors.</p>
<pre><code class="language-swift">fileprivate func setOriginLocation() {
    let q = MPQuery()
    q.query = &quot;venue&quot;
    MPLocationService.sharedInstance().getLocationsUsing(q, filter: MPFilter()) { (locations, err) in
        if let loc = locations?.first {
            self.originLocation = loc
            self.mapControl.go(to: loc)
        }
    }
}
</code></pre>
<p>In the <code>viewDidLoad</code> put the pieces together by calling the above methods.</p>
<pre><code class="language-swift">override func viewDidLoad() {
    super.viewDidLoad()
    setupMap()
    setupSearchButton()
    setupRouteNav()
    setupRenderer()
    setupConstraints()
    setOriginLocation()
}
</code></pre>
<p>Create a <code>updateDirections</code> method that sets up a MapsIndoors directions query. Execute a query and pass the resulting route object to the renderer.</p>
<pre><code class="language-swift">fileprivate func updateDirections() {
    if let origin = originLocation, let destination = destinationLocation {
        let directionsQuery = MPDirectionsQuery.init(origin: origin, destination: destination)
        directions.routing(with: directionsQuery) { (route, error) in
            if let route = route {
                self.directionsVisible = true
                self.routeVC!.route = route
                self.renderer.route = route
                self.renderer.routeLegIndex = 0
                self.stepWiseRenderer.route = route
            }
        }
    }
}
</code></pre>
<h2>Map interactions</h2>
<p>Let's do a couple of extensions for the map interactions. First implement the <code>RouteSegmentsControllerDelegate</code> through an extension. In <code>didSelectRouteSegment</code> update the leg index for the directions renderer.</p>
<pre><code class="language-swift">extension AdvancedDirectionsController : RouteSegmentsControllerDelegate {
    func didSelectRouteSegment(segment: MPRouteSegmentPath) {
        renderer.routeLegIndex = segment.legIndex
        renderer.fitBounds = false
        stepWiseRenderer.routeLegIndex = segment.legIndex
        stepWiseRenderer.routeStepIndex = segment.stepIndex
        stepWiseRenderer.animate(3)
        stepWiseRenderer.fitBounds = true
    }
}
</code></pre>
<p>Implement the <code>MPDirectionsRendererDelegate</code> through an extension. In <code>floorDidChange</code> update the current visible floor on the map control object.</p>
<pre><code class="language-swift">extension AdvancedDirectionsController : MPDirectionsRendererDelegate {
    func floorDidChange(_ floor: NSNumber) {
        mapControl.currentFloor = floor
    }
}
</code></pre>
<p>Implement the <code>MySearchControllerDelegate</code> through an extension. In <code>didSelectLocation</code> update the <code>destinationLocation</code> property.</p>
<pre><code class="language-swift">extension AdvancedDirectionsController : MySearchControllerDelegate {
    func didSelectLocation(location: MPLocation) {
        destinationLocation = location
    }
}
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Advanced%20Directions/AdvancedDirectionsController.swift">See the sample in AdvancedDirectionsController.swift</a></p>

        </main>
      </section>
    </div>
  </div>
  <footer>
  <div class="wrap">
    <div class="flex">
      <div class="third">
        <h2><a href="/ios/v3">iOS v3</a></h2>
        
        <ul><li><a href="/ios/v3/getting-started/">Getting Started</a></li>
<li><a href="/ios/v3/directions/">Directions</a><ul><li><a href="/ios/v3/directions/directions-wayfinding-instructions/">Get Directions and Show Wayfinding Instructions</a></li>
<li><a href="/ios/v3/directions/display-route-on-map/">Display Route on map</a></li>
<li><a href="/ios/v3/directions/directions-result-map/">Get Directions and Show the Result on a Map</a></li>
<li><a href="/ios/v3/directions/working-with-directions-settings/">Working with Directions Settings</a></li>
<li><a href="/ios/v3/directions/working-with-events/">Working with Events</a></li>
<li><a href="/ios/v3/directions/subscribe-to-floor-changes/">Subscribe to floor changes in the rendering</a></li></ul></li>
<li><a href="/ios/v3/locations/">Locations</a><ul><li><a href="/ios/v3/locations/working-grouping/">Working with Location Grouping (Clustering)</a></li>
<li><a href="/ios/v3/locations/creating-own-location-sources/">Creating your own Location Sources</a></li>
<li><a href="/ios/v3/locations/get-details-for-selected-location/">Show details for selected Location</a></li></ul></li>
<li><a href="/ios/v3/live-data/">Live Data</a><ul><li><a href="/ios/v3/live-data/live-data-tutorial/">Working with Live Updates / Real Time Data in MapsIndoors for iOS</a></li></ul></li>
<li><a href="/ios/v3/map-styling/">Map Styling</a><ul><li><a href="/ios/v3/map-styling/change-display-setting/">Working with Display Settings</a></li></ul></li>
<li><a href="/ios/v3/mapsindoors/">MapsIndoors</a><ul><li><a href="/ios/v3/mapsindoors/handling-marker-selections/">Handling marker selections and other user events</a></li>
<li><a href="/ios/v3/mapsindoors/getting-marker-from-location/">Getting a marker from a location and vice versa</a></li>
<li><a href="/ios/v3/mapsindoors/getting-polygon-from-location/">Getting a polygon from a location</a></li>
<li><a href="/ios/v3/mapsindoors/blue-dot/">Show the user's location aka. Blue Dot</a></li>
<li><a href="/ios/v3/mapsindoors/create-custom-ui/">Create custom UI</a></li></ul></li>
<li><a href="/ios/v3/search/">Create a search experience with MapsIndoors</a><ul><li><a href="/ios/v3/search/filter-locations-on-map-by-search-query/">Filter Locations on map by search query</a></li></ul></li>
<li><a href="/ios/v3/offline/">Caching and offline content</a></li></ul>

      </div>
      <div class="third">

        <h2><a href="/android/v3">Android v3</a></h2>
        
        <ul><li><a href="/android/v3/getting-polygon-from-location/">Getting a Polygon from a Location</a></li>
<li><a href="/android/v3/search-locations-display-map/">Searching for Locations and Displaying the Results on a Map</a></li>
<li><a href="/android/v3/live-data/">Live Data</a></li>
<li><a href="/android/v3/locationdatasourcespeoplelocationdatasource/">Creating your own Location Data Source - Part 1</a></li>
<li><a href="/android/v3/locationdatasourcesbatterieslocationdatasource/">Creating your own Location Data Source - Part 2</a></li>
<li><a href="/android/v3/locationdatasourceslocationdatasourcesfragment/">Creating your own Location Data Source - Part 3</a></li>
<li><a href="/android/v3/locationclusteringlocationclusteringfragment/">Work with location grouping / clustering</a></li>
<li><a href="/android/v3/locationdetailsdemolocationdetailsfragment/">Show Location Details</a></li>
<li><a href="/android/v3/searchmapdemosearchfragment/">Create a Search Experience with MapsIndoors - Part 1</a></li>
<li><a href="/android/v3/searchmapdemosearchmapfragment/">Create a Search Experience with MapsIndoors - Part 2</a></li>
<li><a href="/android/v3/showuserlocationdemopositionprovider/">Show the Blue Dot with MapsIndoors - Part 1</a></li>
<li><a href="/android/v3/showuserlocationshowuserlocationfragment/">Show the Blue Dot with MapsIndoors - Part 2</a></li></ul>
      </div>
      <div class="third">
        <h2><a href="/web/v4">Web v4</a></h2>
        
        <ul><li><a href="/web/v4/upgrade-guide/">v4 Upgrade Guide</a></li>
<li><a href="/web/v4/simple-map/">Create a simple map with MapsIndoors</a></li>
<li><a href="/web/v4/display-rules-intro/">Introduction to Display Rules</a></li>
<li><a href="/web/v4/using-events/">Event handling</a></li>
<li><a href="/web/v4/search-and-filtering/">Search and filtering</a></li></ul>

        <h2><a href="/web/v3">Web v3</a></h2>
        
        <ul><li><a href="/web/v3/dynamic-updates/">Update DisplayRules dynamically</a></li>
<li><a href="/web/v3/search-and-filtering/">Search and filtering</a></li>
<li><a href="/web/v3/show-users-position/">Showing the user's location aka. Blue Dot</a></li>
<li><a href="/web/v3/using_events/">Event handling</a></li>
<li><a href="/web/v3/how-to-web-sdk-v3/">How to use the MapsIndoors Web SDK v3</a></li>
<li><a href="/web/v3/simple_map/">How to create a simple map with MapsIndoors</a></li></ul>
      </div>
    </div>

    <hr />
    <div class="flex">
      <div class="third">
        <h2>Legacy versions</h2>
        <h4><a href="/android/v2">Android v2</a></h4>
        <h4><a href="/ios/v2">iOS v2</a></h4>
        <h4><a href="/xamarin">Xamarin v3</a></h4>

      </div>
      <div class="third">
        <h2><a href="/api">Integration API</a></h2>
        <h2><a href="/cms">MapsIndoors CMS</a></h2>
        <h2><a href="/product">Product Overview</a></h2>
      </div>
      <div class="third">
        <h2><a href="/various">Various</a></h2>
        
        <ul><li><a href="/various/glossary/">Glossary</a></li>
<li><a href="/various/areas/">Areas</a></li>
<li><a href="/various/custom-properties/">Custom Properties</a></li>
<li><a href="/various/dashboard/">CMS Dashboard</a></li>
<li><a href="/various/external-id/">External ID</a></li>
<li><a href="/various/google_analytics/">Google Analytics</a></li>
<li><a href="/various/indoor-positioning/">Indoor Positioning with MapsIndoors</a></li>
<li><a href="/various/ip-whitelisting/">Work with MapsIndoors SDK behind a firewall</a></li>
<li><a href="/various/kiosk/">Kiosk</a></li>
<li><a href="/various/location-sources/">Location Sources in MapsIndoors</a></li>
<li><a href="/various/print-map/">Print Map</a></li>
<li><a href="/various/sdk-features/">SDK Features</a></li></ul>
      </div>

    </div>

  </div>
</footer>

</body>

</html>
